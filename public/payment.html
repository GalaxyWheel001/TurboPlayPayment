<!DOCTYPE html>
<html lang="tr" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Ödeme - Hazırsınız</title>
    <script src="https://telegram.org/js/telegram-web-app.js" defer></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap">
    <link rel="stylesheet" href="styles.css?v=6.4">
    <style>
        /* SVG Icons */
        .icon {
            width: 24px;
            height: 24px;
            display: inline-block;
            vertical-align: middle;
        }
        .icon-large {
            width: 48px;
            height: 48px;
        }
        .icon-xl {
            width: 72px;
            height: 72px;
        }
    </style>
</head>
<body class="dark-theme-active">
    <!-- SVG Icons Sprite -->
    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
        <symbol id="icon-card" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="1" y="4" width="22" height="16" rx="2" ry="2"/><line x1="1" y1="10" x2="23" y2="10"/></symbol>
        <symbol id="icon-money" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
            <!-- Premium hex badge (универсально и аккуратно) -->
            <path d="M8 3.8l8 0 4 4v8l-4 4H8l-4-4V7.8l4-4z"/>
            <!-- inner circle (ценность) -->
            <circle cx="12" cy="12" r="3.6"/>
            <!-- shine -->
            <path d="M14.8 6.2l2 2" opacity="0.7"/>
            <path d="M7.2 17.8l1.4-1.4" opacity="0.7"/>
            <!-- tiny star -->
            <path d="M17.5 9.3l.4.9.9.4-.9.4-.4.9-.4-.9-.9-.4.9-.4.4-.9z"/>
        </symbol>
        <symbol id="icon-lock" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></symbol>
        <symbol id="icon-crypto" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 2v20M2 12h20"/></symbol>
        <symbol id="icon-wallet" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12V7H5a2 2 0 0 1 0-4h14v4"/><path d="M3 5v14a2 2 0 0 0 2 2h16v-5"/><path d="M18 12a2 2 0 0 0 0 4h4v-4Z"/></symbol>
        <symbol id="icon-email" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></symbol>
        <symbol id="icon-payment" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="1" y="4" width="22" height="16" rx="2" ry="2"/><line x1="1" y1="10" x2="23" y2="10"/><line x1="7" y1="4" x2="7" y2="10"/></symbol>
        <symbol id="icon-qr" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="5" height="5"/><rect x="16" y="3" width="5" height="5"/><rect x="3" y="16" width="5" height="5"/><line x1="9" y1="9" x2="9" y2="15"/><line x1="15" y1="9" x2="15" y2="15"/><line x1="9" y1="9" x2="15" y2="9"/><line x1="9" y1="15" x2="15" y2="15"/></symbol>
        <symbol id="icon-copy" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></symbol>
        <symbol id="icon-shield" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></symbol>
        <symbol id="icon-check" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"/></symbol>
        <symbol id="icon-theme" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></symbol>
        <symbol id="icon-moon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></symbol>
    </svg>

    <div class="container">
        <!-- Payment Content -->
        <div id="paymentTab" class="tab-content active">
            <!-- Unified Payment Container -->
            <div class="payment-container" id="paymentContainer">
                <!-- Header Section -->
                <div class="payment-header-section">
                    <div class="header-icon-wrapper">
                        <svg class="header-icon"><use href="#icon-card"></use></svg>
                        <div class="header-glow"></div>
                    </div>
                    <h1>Güvenli Ödeme Ağı</h1>
                    <p class="subtitle">İşleminizi güvenle ve hızla tamamlayın</p>
                </div>

                <!-- Amount Summary Section -->
                <div class="payment-amount-section" id="paymentSummary">
                    <div class="amount-display">
                        <div class="amount-icon-wrapper">
                            <svg class="amount-icon"><use href="#icon-money"></use></svg>
                        </div>
                        <div class="amount-content">
                            <span class="amount-label">Toplam tutar</span>
                            <span class="amount-value" id="displayAmount">50.00 USD</span>
                            <span class="amount-hint">Güvenli işlem • Anında onay</span>
                        </div>
                    </div>
                    <div class="security-features">
                        <div class="trust-badge">
                            <svg class="trust-icon"><use href="#icon-shield"></use></svg>
                            <span>SSL ile şifrelenmiş</span>
                        </div>
                        <div class="trust-badge">
                            <svg class="trust-icon"><use href="#icon-lock"></use></svg>
                            <span>Güvenli ödeme</span>
                        </div>
                        <div class="security-feature">
                            <svg class="security-icon"><use href="#icon-shield"></use></svg>
                            <span>256-bit SSL</span>
                        </div>
                        <div class="security-feature">
                            <svg class="security-icon"><use href="#icon-lock"></use></svg>
                            <span>PCI uyumlu</span>
                        </div>
                        <div class="security-feature">
                            <svg class="security-icon"><use href="#icon-shield"></use></svg>
                            <span>7/24 destek</span>
                        </div>
                    </div>
                </div>

                <!-- Payment Form -->
                <div class="payment-form-section" id="paymentForm">
                <!-- Wallet Address -->
                <div class="form-section">
                    <div class="form-section-title">
                        <svg class="section-icon"><use href="#icon-wallet"></use></svg>
                        <span data-i18n="walletAddressTitle">Bitcoin cüzdan adresi</span>
                    </div>
                    <div class="form-group">
                        <div class="wallet-address-wrapper">
                            <input type="text" id="walletAddress" readonly value="bc1qz72xtj5yscxdldrp6k6dvejav8xsln8jp9dz6s">
                            <button class="btn-icon-btn" id="copyAddressBtn" onclick="copyWalletAddress()" title="Adresi kopyala">
                                <svg class="icon"><use href="#icon-copy"></use></svg>
                            </button>
                        </div>
                        <small id="walletHint" data-i18n="walletHint">Ödemeleri almak için Bitcoin cüzdan adresiniz</small>
                    </div>
                </div>

                <!-- Contact Information -->
                <div class="form-section">
                    <div class="form-section-title">
                        <svg class="section-icon"><use href="#icon-email"></use></svg>
                        <span data-i18n="contactInfoTitle">İletişim bilgileri</span>
                    </div>
                    <div class="form-group">
                        <label for="email" data-i18n="emailLabel">E-posta adresiniz</label>
                        <div class="input-wrapper">
                            <input type="email" id="email" placeholder="ornek@eposta.com" required>
                            <div class="input-status" id="emailStatus"></div>
                        </div>
                        <small id="emailHint" data-i18n="emailHint">Ödeme onayını bu adrese gönderiyoruz</small>
                    </div>
                </div>

                <!-- Progress Bar -->
                <div id="progressContainer" class="progress-container" style="display: none;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <p class="progress-text" id="progressText">Ödeme hazırlanıyor...</p>
                </div>

                    <div class="payment-cta">
                        <button class="btn btn-primary" id="payButton" onclick="createPayment('moonpay')">
                            <svg class="btn-icon"><use href="#icon-card"></use></svg>
                            <span data-i18n="payButton">Güvenli ödemeye geç</span>
                        </button>
                        <p class="payment-guarantee">
                            <svg class="guarantee-icon"><use href="#icon-shield"></use></svg>
                            <span data-i18n="paymentGuarantee">Ödemeniz sektör lideri güvenlik ile korunur</span>
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Toast Container -->
        <div class="toast-container" id="toastContainer"></div>

        <!-- Loading Overlay -->
        <div class="loading-overlay" id="loading" style="display: none;">
            <div class="loading-content">
                <div class="spinner"></div>
                <div class="loading-dots">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                <p id="loadingText">Ödeme işleniyor...</p>
            </div>
        </div>

        <!-- Payment Result Modal -->
        <div class="modal-overlay" id="paymentResult" style="display: none;">
            <div class="modal-content">
                <div class="result-content" id="resultContent"></div>
                <button class="btn btn-secondary" onclick="resetForm()">Yeni ödeme</button>
            </div>
        </div>
    </div>

    <script>
        // Обработка ошибок загрузки скриптов
        window.addEventListener('error', function(e) {
            console.error('Script error:', e);
            // Показываем страницу даже при ошибках
            if (document.body) {
                document.body.style.visibility = 'visible';
                document.body.style.opacity = '1';
            }
        }, true);
        
        // Показываем страницу сразу
        document.addEventListener('DOMContentLoaded', function() {
            if (document.body) {
                document.body.style.visibility = 'visible';
                document.body.style.opacity = '1';
            }
        });
        
        // Ожидание загрузки Telegram Web App API
        function initApp() {
            // Проверяем, что DOM загружен
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initApp);
                return;
            }
            
            // Даем время на загрузку Telegram Web App API
            setTimeout(function() {
                try {
                    // Инициализируем приложение
                    if (typeof window.initPaymentApp === 'function') {
                        window.initPaymentApp();
                    } else {
                        // Если функция еще не загружена, ждем еще
                        setTimeout(function() {
                            if (typeof window.initPaymentApp === 'function') {
                                window.initPaymentApp();
                            }
                        }, 200);
                    }
                } catch (error) {
                    console.error('Error initializing app:', error);
                    // Показываем страницу даже если есть ошибки
                    if (document.body) {
                        document.body.style.visibility = 'visible';
                        document.body.style.opacity = '1';
                    }
                }
            }, 150);
        }
        
        // Запускаем инициализацию
        initApp();
    </script>
    <script src="i18n.js"></script>
    <script src="payment.js"></script>
</body>
</html>
